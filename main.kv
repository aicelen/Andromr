ScreenManager:
    LandingPage:
    CameraPage:
    EditImagePage:
    ProgressPage:
    SettingsPage:
    DownloadPage:
    OSSLicensePage:
    LicensePageButton:
    LicensePage:
    
<LandingPage>:
    name: "landing"
    BoxLayout:
        orientation: 'vertical'
        padding: [dp(0), dp(20), dp(0), dp(app.bottom_pad)]

        MDTopAppBar:
            id: toolbar_landing
            title: "Home"
            elevation: 0
            type_height: 'small'
            right_action_items: [['dots-vertical', lambda x: app.open_menu(x)]]
            md_bg_color: (0, 0, 0, 1) if app.theme_cls.theme_style == 'Dark' else (1, 1, 1, 1)
            specific_text_color: (1, 1, 1, 1) if app.theme_cls.theme_style == 'Dark' else (0, 0, 0, 1)

        BoxLayout:
            orientation: 'vertical'
            padding: dp(20)
            spacing: dp(10)
            ScrollView:
                id: scroll_view
                size_hint_y: 0.75
                BoxLayout:
                    id: scroll_box
                    orientation: 'vertical'
                    size_hint_y: None
                    height: self.minimum_height
                    padding: dp(10)
                    spacing: dp(10)
                    
            BoxLayout:
                orientation: "horizontal"
                size_hint_y: 0.1  
                MDFloatingActionButton:
                    icon: "cog"
                    on_release: app.change_screen("settings")

                Widget:

                MDFloatingActionButton:
                    id: gen_xml
                    icon: "upload"
                    on_release: app.check_download_assets(camera_page=True)


<CameraPage>:
    name: "camera"
    orientation: 'vertical'
    size: root.width, root.height
    KvCam:
        id: camera_pre
        fit_mode: 'contain'
        play: True

    MDIconButton: 
        id: img_taker
        icon: "circle-slice-8"
        size_hint_x: None
        pos_hint: {'center_x': 0.5, 'center_y': 0.125}
        on_release: app.capture()
        icon_size: "80dp"


<EditImagePage>:
    name: "image_page"

    MDBoxLayout:
        id: image_box

    MDBoxLayout:
        id: btn_box
        orientation: "horizontal"
        padding: [dp(10), dp(20), dp(10), dp(app.bottom_pad)]
        spacing: dp(10)

        MDRaisedButton:
            text: "Crop!"
            size_hint: None, None
            pos_hint: {'center_x': 0.5}
            on_release: app.crop()

        Widget:

        MDRaisedButton:
            text: "Start without cropping"
            size_hint: None, None
            pos_hint: {'center_x': 0.5}
            on_release: app.start_inference(app.img_path)

        Widget:

        MDRaisedButton:
            text: "Retry"
            size_hint: None, None
            pos_hint: {'center_x': 0.5}
            on_release: app.change_screen("camera")

    MovableMDIconButton:
        id: btn0
        icon: "circle-medium"
        size_hint: None, None
        pos: 30, 30
        ripple_scale: 0
        theme_text_color: "Custom"
        text_color: 1, 0, 0, 1  # Red

    UnmovableMDIconButton:
        id: btn1
        icon: "circle-medium"
        size_hint: None, None
        pos: 30, 30
        disabled: True 
        opacity: 0
        ripple_scale: 0
        theme_text_color: "Custom"
        text_color: 1, 0, 0, 1  # Red

    UnmovableMDIconButton:
        id: btn2 
        icon: "circle-medium"
        size_hint: None, None
        pos: 30, 30
        disabled: True 
        opacity: 0
        ripple_scale: 0
        theme_text_color: "Custom"
        text_color: 1, 0, 0, 1  # Red

    MovableMDIconButton:
        id: btn3
        icon: "circle-medium"
        size_hint: None, None
        pos: 30, 30
        ripple_scale: 0
        theme_text_color: "Custom"
        text_color: 1, 0, 0, 1  # Red
        
    LineDrawer:
        id: line_drawer

<ProgressPage>:
    name: "progress"
    BoxLayout:
        orientation: 'vertical'
        padding: [dp(0), dp(20), dp(0), dp(app.bottom_pad)]
        MDTopAppBar:
            id: toolbar_progress
            title: "OMR"
            elevation: 0
            type_height: 'small'
            md_bg_color: (0, 0, 0, 1) if app.theme_cls.theme_style == 'Dark' else (1, 1, 1, 1)
            specific_text_color: (1, 1, 1, 1) if app.theme_cls.theme_style == 'Dark' else (0, 0, 0, 1)

        MDBoxLayout:
            orientation: "vertical"
            spacing: dp(20)
            padding: dp(10)
            
            Widget:

            MDTextField:
                id: title
                hint_text: "Title"
                mode: "round"

            MDBoxLayout:
                orientation: "horizontal"
                spacing: dp(20)
                padding: dp(10)

                MDTextField:
                    id: beat
                    hint_text: "Beat"
                    mode: "round"
                    helper_text: "Only natural numbers (1,2,3...)"
                    helper_text_mode: "on_focus"


                MDTextField:
                    id: division
                    hint_text: "Beat Type"
                    mode: "round"
                    helper_text: "Only natural numbers"
                    helper_text_mode: "on_focus"


            Widget:

            MDProgressBar:
                id: progress_bar
                size_hint_y: None
                height: dp(10)  # Set the height of the progress bar
                pos_hint: {"center_x": 0.5}

            MDLabel:
                id: progress_label
                text: "0%"
                halign: 'center'
                size_hint_y: None
                height: self.texture_size[1]  # Ensure the label only takes the needed height

<SettingsPage>:
    name: "settings"
    MDBoxLayout:
        orientation: "vertical"
        padding: [dp(0), dp(20), dp(0), dp(app.bottom_pad)]
        MDTopAppBar:
            id: toolbar_settings
            title: "Settings"
            elevation: 0
            type_height: 'small'
            left_action_items: [['arrow-left', lambda x: app.save_settings(root.ids.slider_threads.value, root.ids.checkbox_xnnpack.active, x)]]
            right_action_items: [['dots-vertical', lambda x: app.open_menu(x)]]
            md_bg_color: (0, 0, 0, 1) if app.theme_cls.theme_style == 'Dark' else (1, 1, 1, 1)
            specific_text_color: (1, 1, 1, 1) if app.theme_cls.theme_style == 'Dark' else (0, 0, 0, 1)

        MDBoxLayout:
            orientation: "vertical"
            padding: dp(25)

            MDBoxLayout:
                MDLabel:
                    id: label_xnnpack
                    text: "Xnnpack acceleration"

                MDCheckbox:
                    id: checkbox_xnnpack
                    active: app.appdata.xnnpack
                    ripple_scale: 0
                    pos_hint: {'center_y': 0.5}
                    size_hint: None, None
                    size: "48dp", "48dp"

            MDBoxLayout:
                MDLabel:
                    id: l_threads
                    text: "Threads"

                MDIconButton:
                    id: inf_threads
                    icon: "information-slab-circle-outline"
                    pos_hint: {'center_y': 0.5}
                    on_release: app.show_info("Number of threads the models can utilize. Use number of big cores of your SOC. If you're unsure use 2 for lower end phones, else 4. \nDefault: 2")
                    ripple_scale: 0

            MDSlider:
                id: slider_threads
                min: 1
                max: 8
                value: app.appdata.threads
                step: 1
                show_off: False
                

            MDBoxLayout:
                orientation: "horizontal"
                MDRaisedButton:
                    text: "Download assets (60MB)"
                    on_release: app.check_download_assets()
                    size_hint_x: 1

            Widget:

<DownloadPage>
    name: "downloadpage"
    BoxLayout:
        padding: [dp(0), dp(20), dp(0), dp(app.bottom_pad)]
        orientation: 'vertical'
        MDTopAppBar:
            id: toolbar_download
            title: "Download Assets"
            elevation: 0
            type_height: 'small'
            md_bg_color: (0, 0, 0, 1) if app.theme_cls.theme_style == 'Dark' else (1, 1, 1, 1)
            specific_text_color: (1, 1, 1, 1) if app.theme_cls.theme_style == 'Dark' else (0, 0, 0, 1)

        MDBoxLayout:
            orientation: "vertical"
            spacing: dp(20)
            padding: dp(10)
            Widget:

            MDProgressBar:
                id: download_bar
                size_hint_y: None
                height: dp(10)
                pos_hint: {"center_x": 0.5}

            MDLabel:
                id: download_label
                text: "0/4"
                halign: 'center'
                size_hint_y: None
                height: self.texture_size[1]

<OSSLicensePage>:
    name: 'osslicensepage'
    BoxLayout:
        orientation: 'vertical'
        padding: [dp(0), dp(20), dp(0), dp(app.bottom_pad)]
        MDTopAppBar:
            id: toolbar_osslicensepage
            title: "About"
            elevation: 0
            type_height: 'small'
            left_action_items: [['arrow-left', lambda x: app.change_screen("landing", x)]]
            right_action_items: [['dots-vertical', lambda x: app.open_menu(x)]]
            md_bg_color: (0, 0, 0, 1) if app.theme_cls.theme_style == 'Dark' else (1, 1, 1, 1)
            specific_text_color: (1, 1, 1, 1) if app.theme_cls.theme_style == 'Dark' else (0, 0, 0, 1)


        BoxLayout:
            orientation: 'vertical'
            padding: dp(10)
            spacing: dp(10)
            OSS_Licenses:
                id: rv_lp

<LicensePage>:
    name: 'licensepage'
    BoxLayout:
        orientation: 'vertical'
        padding: [dp(0), dp(20), dp(0), dp(app.bottom_pad)]
        MDTopAppBar:
            id: toolbar_licensepage
            title: "License"
            elevation: 0
            type_height: 'small'
            left_action_items: [['arrow-left', lambda x: app.change_screen("landing", x)]]
            right_action_items: [['dots-vertical', lambda x: app.open_menu(x)]]
            md_bg_color: (0, 0, 0, 1) if app.theme_cls.theme_style == 'Dark' else (1, 1, 1, 1)
            specific_text_color: (1, 1, 1, 1) if app.theme_cls.theme_style == 'Dark' else (0, 0, 0, 1)
        BoxLayout:
            orientation: 'vertical'
            padding: dp(10)
            spacing: dp(10)        
            License:
                id: rv_tp

<LicensePageButton>:
    name: 'licensepagebutton'
    BoxLayout:
        padding: [dp(0), dp(20), dp(0), dp(app.bottom_pad)]
        orientation: 'vertical'
        spacing: dp(10)        
        License:
            id: rv_tpb
        MDRaisedButton:
            text: 'I read and agree to the License'
            size_hint_y: None
            height: '40dp'
            on_release: app.agree_license()
            padding: dp(10)
            spacing: dp(10)
<OSS_Licenses>:
    viewclass: 'WrappedLabel'
    RecycleBoxLayout:
        key_size: 'height'
        default_size_hint: 1, None
        size_hint_y: None
        height: self.minimum_height
        orientation: 'vertical'

<License>:
    viewclass: 'WrappedLabel'
    RecycleBoxLayout:
        key_size: 'size'   
        default_size: None, None
        default_size_hint: 1, None
        size_hint_y: None
        height: self.minimum_height
        orientation: 'vertical'

<WrappedLabel@Label>:
    markup: True
    font_size: '10sp'
    text_size: self.width, None
    size_hint_y: None
    halign: 'left'
    valign: 'top'
    padding: 10, 10
